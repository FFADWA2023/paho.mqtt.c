<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Paho Asynchronous MQTT C Client Library: Tracing</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="pahologo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Paho Asynchronous MQTT C Client Library
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Tracing </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Runtime tracing can be controlled by environment variables or API calls.</p>
<h4><a class="anchor" id="autotoc_md0"></a>
Environment variables</h4>
<p>Tracing is switched on by setting the MQTT_C_CLIENT_TRACE environment variable. A value of ON, or stdout, prints to stdout, any other value is interpreted as a file name to use.</p>
<p>The amount of trace detail is controlled with the MQTT_C_CLIENT_TRACE_LEVEL environment variable - valid values are ERROR, PROTOCOL, MINIMUM, MEDIUM and MAXIMUM (from least to most verbose).</p>
<p>The variable MQTT_C_CLIENT_TRACE_MAX_LINES limits the number of lines of trace that are output to a file. Two files are used at most, when they are full, the last one is overwritten with the new trace entries. The default size is 1000 lines.</p>
<h4><a class="anchor" id="autotoc_md1"></a>
Trace API calls</h4>
<p><a class="el" href="_m_q_t_t_async_8h.html#a65aba1caeae9b5af5d5b6c5598a75b02">MQTTAsync_traceCallback()</a> is used to set a callback function which is called whenever trace information is available. This will be the same information as that printed if the environment variables were used to control the trace.</p>
<p>The <a class="el" href="_m_q_t_t_async_8h.html#af22a1edd266e92ded5fb0e02541ab8c0">MQTTAsync_setTraceLevel()</a> calls is used to set the maximum level of trace entries that will be passed to the callback function. The levels are:</p><ol type="1">
<li><a class="el" href="_m_q_t_t_async_8h.html#a5de816f986b318947709a34e0787eda5af684f42971cced68693ce993703548c1">MQTTASYNC_TRACE_MAXIMUM</a></li>
<li><a class="el" href="_m_q_t_t_async_8h.html#a5de816f986b318947709a34e0787eda5a133c380b84d75477ff31a2ad732133ce">MQTTASYNC_TRACE_MEDIUM</a></li>
<li><a class="el" href="_m_q_t_t_async_8h.html#a5de816f986b318947709a34e0787eda5a7a45c26816b1cac1fde02d79a9f4337b">MQTTASYNC_TRACE_MINIMUM</a></li>
<li><a class="el" href="_m_q_t_t_async_8h.html#a5de816f986b318947709a34e0787eda5a6a719b2b7fc4dfc41494370ff96fec3e">MQTTASYNC_TRACE_PROTOCOL</a></li>
<li><a class="el" href="_m_q_t_t_async_8h.html#a5de816f986b318947709a34e0787eda5ac428f74ca453dacb7b8271ca741266e8">MQTTASYNC_TRACE_ERROR</a></li>
<li><a class="el" href="_m_q_t_t_async_8h.html#a5de816f986b318947709a34e0787eda5a3084770185f384398cefe4aaba533d40">MQTTASYNC_TRACE_SEVERE</a></li>
<li><a class="el" href="_m_q_t_t_async_8h.html#a5de816f986b318947709a34e0787eda5a0b91d2213ebb6655e41a7f6ce1a42295">MQTTASYNC_TRACE_FATAL</a></li>
</ol>
<p>Selecting <a class="el" href="_m_q_t_t_async_8h.html#a5de816f986b318947709a34e0787eda5af684f42971cced68693ce993703548c1">MQTTASYNC_TRACE_MAXIMUM</a> will cause all trace entries at all levels to be returned. Choosing <a class="el" href="_m_q_t_t_async_8h.html#a5de816f986b318947709a34e0787eda5ac428f74ca453dacb7b8271ca741266e8">MQTTASYNC_TRACE_ERROR</a> will cause ERROR, SEVERE and FATAL trace entries to be returned to the callback function.</p>
<h3><a class="anchor" id="autotoc_md2"></a>
MQTT Packet Tracing</h3>
<p>A feature that can be very useful is printing the MQTT packets that are sent and received. To achieve this, use the following environment variable settings: </p><div class="fragment"><div class="line">MQTT_C_CLIENT_TRACE=ON</div>
<div class="line">MQTT_C_CLIENT_TRACE_LEVEL=PROTOCOL</div>
</div><!-- fragment --><p> The output you should see looks like this: </p><div class="fragment"><div class="line">20130528 155936.813 3 stdout-subscriber -&gt; <a class="code" href="_m_q_t_t_packet_8h.html#af4abe6dde4474d89bf885edc0a07393fa20391dd2915a0e64343d24c2f2e40b95">CONNECT</a> cleansession: 1 (0)</div>
<div class="line">20130528 155936.813 3 stdout-subscriber &lt;- <a class="code" href="_m_q_t_t_packet_8h.html#af4abe6dde4474d89bf885edc0a07393faa636430e8d9563704f7328824d6bc0a5">CONNACK</a> rc: 0</div>
<div class="line">20130528 155936.813 3 stdout-subscriber -&gt; <a class="code" href="_m_q_t_t_packet_8h.html#af4abe6dde4474d89bf885edc0a07393fabc6f919ff681f5f552b2f7d1f0fba832">SUBSCRIBE</a> msgid: 1 (0)</div>
<div class="line">20130528 155936.813 3 stdout-subscriber &lt;- <a class="code" href="_m_q_t_t_packet_8h.html#af4abe6dde4474d89bf885edc0a07393fabe48cb8225101545fd55752f2534348d">SUBACK</a> msgid: 1</div>
<div class="line">20130528 155941.818 3 stdout-subscriber -&gt; <a class="code" href="_m_q_t_t_packet_8h.html#af4abe6dde4474d89bf885edc0a07393fa2f6318afb30e8e2817e6203ebedc8173">DISCONNECT</a> (0)</div>
<div class="ttc" id="a_m_q_t_t_packet_8h_html_af4abe6dde4474d89bf885edc0a07393fa20391dd2915a0e64343d24c2f2e40b95"><div class="ttname"><a href="_m_q_t_t_packet_8h.html#af4abe6dde4474d89bf885edc0a07393fa20391dd2915a0e64343d24c2f2e40b95">CONNECT</a></div><div class="ttdeci">@ CONNECT</div><div class="ttdef"><b>Definition:</b> MQTTPacket.h:43</div></div>
<div class="ttc" id="a_m_q_t_t_packet_8h_html_af4abe6dde4474d89bf885edc0a07393fa2f6318afb30e8e2817e6203ebedc8173"><div class="ttname"><a href="_m_q_t_t_packet_8h.html#af4abe6dde4474d89bf885edc0a07393fa2f6318afb30e8e2817e6203ebedc8173">DISCONNECT</a></div><div class="ttdeci">@ DISCONNECT</div><div class="ttdef"><b>Definition:</b> MQTTPacket.h:45</div></div>
<div class="ttc" id="a_m_q_t_t_packet_8h_html_af4abe6dde4474d89bf885edc0a07393faa636430e8d9563704f7328824d6bc0a5"><div class="ttname"><a href="_m_q_t_t_packet_8h.html#af4abe6dde4474d89bf885edc0a07393faa636430e8d9563704f7328824d6bc0a5">CONNACK</a></div><div class="ttdeci">@ CONNACK</div><div class="ttdef"><b>Definition:</b> MQTTPacket.h:43</div></div>
<div class="ttc" id="a_m_q_t_t_packet_8h_html_af4abe6dde4474d89bf885edc0a07393fabc6f919ff681f5f552b2f7d1f0fba832"><div class="ttname"><a href="_m_q_t_t_packet_8h.html#af4abe6dde4474d89bf885edc0a07393fabc6f919ff681f5f552b2f7d1f0fba832">SUBSCRIBE</a></div><div class="ttdeci">@ SUBSCRIBE</div><div class="ttdef"><b>Definition:</b> MQTTPacket.h:44</div></div>
<div class="ttc" id="a_m_q_t_t_packet_8h_html_af4abe6dde4474d89bf885edc0a07393fabe48cb8225101545fd55752f2534348d"><div class="ttname"><a href="_m_q_t_t_packet_8h.html#af4abe6dde4474d89bf885edc0a07393fabe48cb8225101545fd55752f2534348d">SUBACK</a></div><div class="ttdeci">@ SUBACK</div><div class="ttdef"><b>Definition:</b> MQTTPacket.h:44</div></div>
</div><!-- fragment --><p> where the fields are:</p><ol type="1">
<li>date</li>
<li>time</li>
<li>socket number</li>
<li>client id</li>
<li>direction (-&gt; from client to server, &lt;- from server to client)</li>
<li>packet details</li>
</ol>
<h3><a class="anchor" id="autotoc_md3"></a>
Default Level Tracing</h3>
<p>This is an extract of a default level trace of a call to connect: </p><div class="fragment"><div class="line">19700101 010000.000 (1152206656) (0)&gt; <a class="code" href="_m_q_t_t_client_8c.html#aaa8ae61cd65c9dc0846df10122d7bd4e">MQTTClient_connect</a>:893</div>
<div class="line">19700101 010000.000 (1152206656)  (1)&gt; MQTTClient_connectURI:716</div>
<div class="line">20130528 160447.479 Connecting to serverURI localhost:1883</div>
<div class="line">20130528 160447.479 (1152206656)   (2)&gt; <a class="code" href="_m_q_t_t_protocol_out_8c.html#ad80974c5f8b8e539146dafed2cccefb9">MQTTProtocol_connect</a>:98</div>
<div class="line">20130528 160447.479 (1152206656)    (3)&gt; <a class="code" href="_m_q_t_t_protocol_out_8c.html#aa3c6fb1006b4dad8f122a9544cc2d5df">MQTTProtocol_addressPort</a>:48</div>
<div class="line">20130528 160447.479 (1152206656)    (3)&lt; <a class="code" href="_m_q_t_t_protocol_out_8c.html#aa3c6fb1006b4dad8f122a9544cc2d5df">MQTTProtocol_addressPort</a>:73</div>
<div class="line">20130528 160447.479 (1152206656)    (3)&gt; <a class="code" href="_socket_8c.html#a23176785a5afc34efb466dac4d7fce87">Socket_new</a>:599</div>
<div class="line">20130528 160447.479 New socket 4 <span class="keywordflow">for</span> localhost, port 1883</div>
<div class="line">20130528 160447.479 (1152206656)     (4)&gt; <a class="code" href="_socket_8c.html#a3c690a1d23a55ccf1ea52cdea9b56432">Socket_addSocket</a>:163</div>
<div class="line">20130528 160447.479 (1152206656)      (5)&gt; <a class="code" href="_socket_8c.html#a90f49db5a5763c6874f27facfe9e60a3">Socket_setnonblocking</a>:73</div>
<div class="line">20130528 160447.479 (1152206656)      (5)&lt; <a class="code" href="_socket_8c.html#a90f49db5a5763c6874f27facfe9e60a3">Socket_setnonblocking</a>:78 (0)</div>
<div class="line">20130528 160447.479 (1152206656)     (4)&lt; <a class="code" href="_socket_8c.html#a3c690a1d23a55ccf1ea52cdea9b56432">Socket_addSocket</a>:176 (0)</div>
<div class="line">20130528 160447.479 (1152206656)     (4)&gt; <a class="code" href="_socket_8c.html#a47824ad5afba267b9488150e1f7e8610">Socket_error</a>:95</div>
<div class="line">20130528 160447.479 (1152206656)     (4)&lt; <a class="code" href="_socket_8c.html#a47824ad5afba267b9488150e1f7e8610">Socket_error</a>:104 (115)</div>
<div class="line">20130528 160447.479 <a class="code" href="struct_connect.html">Connect</a> pending</div>
<div class="line">20130528 160447.479 (1152206656)    (3)&lt; <a class="code" href="_socket_8c.html#a23176785a5afc34efb466dac4d7fce87">Socket_new</a>:683 (115)</div>
<div class="line">20130528 160447.479 (1152206656)   (2)&lt; <a class="code" href="_m_q_t_t_protocol_out_8c.html#ad80974c5f8b8e539146dafed2cccefb9">MQTTProtocol_connect</a>:131 (115)</div>
<div class="ttc" id="a_m_q_t_t_client_8c_html_aaa8ae61cd65c9dc0846df10122d7bd4e"><div class="ttname"><a href="_m_q_t_t_client_8c.html#aaa8ae61cd65c9dc0846df10122d7bd4e">MQTTClient_connect</a></div><div class="ttdeci">int MQTTClient_connect(MQTTClient handle, MQTTClient_connectOptions *options)</div><div class="ttdef"><b>Definition:</b> MQTTClient.c:1189</div></div>
<div class="ttc" id="a_m_q_t_t_protocol_out_8c_html_aa3c6fb1006b4dad8f122a9544cc2d5df"><div class="ttname"><a href="_m_q_t_t_protocol_out_8c.html#aa3c6fb1006b4dad8f122a9544cc2d5df">MQTTProtocol_addressPort</a></div><div class="ttdeci">char * MQTTProtocol_addressPort(const char *uri, int *port)</div><div class="ttdef"><b>Definition:</b> MQTTProtocolOut.c:49</div></div>
<div class="ttc" id="a_m_q_t_t_protocol_out_8c_html_ad80974c5f8b8e539146dafed2cccefb9"><div class="ttname"><a href="_m_q_t_t_protocol_out_8c.html#ad80974c5f8b8e539146dafed2cccefb9">MQTTProtocol_connect</a></div><div class="ttdeci">int MQTTProtocol_connect(const char *ip_address, Clients *aClient, int MQTTVersion)</div><div class="ttdef"><b>Definition:</b> MQTTProtocolOut.c:99</div></div>
<div class="ttc" id="a_socket_8c_html_a23176785a5afc34efb466dac4d7fce87"><div class="ttname"><a href="_socket_8c.html#a23176785a5afc34efb466dac4d7fce87">Socket_new</a></div><div class="ttdeci">int Socket_new(char *addr, int port, int *sock)</div><div class="ttdef"><b>Definition:</b> Socket.c:654</div></div>
<div class="ttc" id="a_socket_8c_html_a3c690a1d23a55ccf1ea52cdea9b56432"><div class="ttname"><a href="_socket_8c.html#a3c690a1d23a55ccf1ea52cdea9b56432">Socket_addSocket</a></div><div class="ttdeci">int Socket_addSocket(int newSd)</div><div class="ttdef"><b>Definition:</b> Socket.c:170</div></div>
<div class="ttc" id="a_socket_8c_html_a47824ad5afba267b9488150e1f7e8610"><div class="ttname"><a href="_socket_8c.html#a47824ad5afba267b9488150e1f7e8610">Socket_error</a></div><div class="ttdeci">int Socket_error(char *aString, int sock)</div><div class="ttdef"><b>Definition:</b> Socket.c:100</div></div>
<div class="ttc" id="a_socket_8c_html_a90f49db5a5763c6874f27facfe9e60a3"><div class="ttname"><a href="_socket_8c.html#a90f49db5a5763c6874f27facfe9e60a3">Socket_setnonblocking</a></div><div class="ttdeci">int Socket_setnonblocking(int sock)</div><div class="ttdef"><b>Definition:</b> Socket.c:73</div></div>
<div class="ttc" id="astruct_connect_html"><div class="ttname"><a href="struct_connect.html">Connect</a></div><div class="ttdef"><b>Definition:</b> MQTTPacket.h:85</div></div>
</div><!-- fragment --><p> where the fields are:</p><ol type="1">
<li>date</li>
<li>time</li>
<li>thread id</li>
<li>function nesting level</li>
<li>function entry (&gt;) or exit (&lt;)</li>
<li>function name : line of source code file</li>
<li>return value (if there is one)</li>
</ol>
<h3><a class="anchor" id="autotoc_md4"></a>
Memory Allocation Tracing</h3>
<p>Setting the trace level to maximum causes memory allocations and frees to be traced along with the default trace entries, with messages like the following: </p><div class="fragment"><div class="line">20130528 161819.657 Allocating 16 <a class="code" href="utf-8_8c.html#acb1359f3bdc4a6ab64e47c3707640a7b">bytes</a> in heap at file /home/icraggs/workspaces/mqrtc/mqttv3c/src/<a class="code" href="struct_m_q_t_t_packet.html">MQTTPacket</a>.c line 177 ptr 0x179f930</div>
<div class="line"> </div>
<div class="line">20130528 161819.657 Freeing 16 <a class="code" href="utf-8_8c.html#acb1359f3bdc4a6ab64e47c3707640a7b">bytes</a> in heap at file /home/icraggs/workspaces/mqrtc/mqttv3c/src/<a class="code" href="struct_m_q_t_t_packet.html">MQTTPacket</a>.c line 201, heap use now 896 <a class="code" href="utf-8_8c.html#acb1359f3bdc4a6ab64e47c3707640a7b">bytes</a></div>
<div class="ttc" id="astruct_m_q_t_t_packet_html"><div class="ttname"><a href="struct_m_q_t_t_packet.html">MQTTPacket</a></div><div class="ttdef"><b>Definition:</b> MQTTPacket.h:156</div></div>
<div class="ttc" id="autf-8_8c_html_acb1359f3bdc4a6ab64e47c3707640a7b"><div class="ttname"><a href="utf-8_8c.html#acb1359f3bdc4a6ab64e47c3707640a7b">bytes</a></div><div class="ttdeci">struct @20::@21 bytes[4]</div></div>
</div><!-- fragment --><p> When the last MQTT client object is destroyed, if the trace is being recorded and all memory allocated by the client library has not been freed, an error message will be written to the trace. This can help with fixing memory leaks. The message will look like this: </p><div class="fragment"><div class="line">20130528 163909.208 Some memory not freed at shutdown, possible memory leak</div>
<div class="line">20130528 163909.208 Heap scan start, total 880 <a class="code" href="utf-8_8c.html#acb1359f3bdc4a6ab64e47c3707640a7b">bytes</a></div>
<div class="line">20130528 163909.208 Heap element size 32, line 354, file /home/icraggs/workspaces/mqrtc/mqttv3c/src/<a class="code" href="struct_m_q_t_t_packet.html">MQTTPacket</a>.c, ptr 0x260cb00</div>
<div class="line">20130528 163909.208   Content</div>
<div class="line">20130528 163909.209 Heap scan end</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Nov 19 2024 16:44:21 for Paho Asynchronous MQTT C Client Library by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
